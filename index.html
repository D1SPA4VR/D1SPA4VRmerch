<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>D1SPA4VR Merch</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
  <style>
    /* styles remain unchanged */
  </style>
</head>
<body>

<header>D1SPA4VR Merch</header>
<div class="tabs">
  <button onclick="showPage('home')">Home</button>
  <button onclick="showPage('wishlist')">Wishlist</button>
</div>

<div id="home" class="page">
  <div class="container" id="productList"></div>
</div>

<div id="wishlist" class="page wishlist-page" style="display:none">
  <ul id="wishlistItems"></ul>
</div>

<div id="productDetail" class="page" style="display:none"></div>

<button class="owner-button" onclick="requestOwnerAccess()">Owner Button</button>
<a href="https://merchdp.github.io/" class="external-button" target="_blank">Go to Site</a>
<div id="ownerPanel">
  <button class="close-panel" onclick="toggleOwnerPanel(false)">&times;</button>
  <h3>üõ†Ô∏è Owner Panel</h3>
  <div id="ownerControls"></div>
  <h4 style="color:#fff;margin-top:1rem">Add New Product</h4>
  <input type="text" id="newName" placeholder="Name" style="width:100%;margin:0.3rem 0" />
  <input type="text" id="newDesc" placeholder="Description" style="width:100%;margin:0.3rem 0" />
  <input type="number" id="newPrice" placeholder="Price" style="width:100%;margin:0.3rem 0" />
  <input type="number" id="newShipping" placeholder="Shipping" style="width:100%;margin:0.3rem 0" />
  <button onclick="addProduct()" style="margin-top:0.5rem;background:#28a745;color:white;padding:0.5rem 1rem;border:none;border-radius:5px;cursor:pointer">Add Product</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBDeI1Vtvnwpv4GPJfH9oqrhoD1BVVqebk",
  authDomain: "d1spa4vr-merch.firebaseapp.com",
  databaseURL: "https://d1spa4vr-merch-default-rtdb.firebaseio.com",
  projectId: "d1spa4vr-merch",
  storageBucket: "d1spa4vr-merch.appspot.com",
  messagingSenderId: "862122277887",
  appId: "1:862122277887:web:9db63669e5b2dac4f445ca"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let products = [];
let stockStatus = {};
let wishlist = [];

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  document.getElementById(id).style.display = 'block';
  if (id === 'wishlist') renderWishlist();
}

function renderProducts() {
  const container = document.getElementById("productList");
  container.innerHTML = "";
  products.forEach((p, i) => {
    const inStock = stockStatus[i];
    const card = document.createElement("div");
    card.className = "product";
    card.onclick = () => showProductDetail(i);
    card.innerHTML = `
      <h2>${p.name}</h2>
      <p>$${p.price?.toFixed(2) ?? 0} + $${p.shipping?.toFixed(2) ?? 0} shipping</p>
      <div class="stock-label ${inStock ? 'in-stock' : 'out-stock'}">
        ${inStock ? 'In Stock' : 'Out of Stock'}
      </div>
    `;
    container.appendChild(card);
  });
}

function showProductDetail(i) {
  const p = products[i];
  document.getElementById("productDetail").innerHTML = `
    <div class="product-detail">
      <h2>${p.name}</h2>
      <p><strong>Price:</strong> $${p.price?.toFixed(2) ?? 0} + $${p.shipping?.toFixed(2) ?? 0} shipping</p>
      <p>${p.desc}</p>
      <button class="wishlist-btn" onclick="addToWishlist(${i})">Add to Wishlist</button>
      <a href="https://forms.gle/LqTLJ4DcNXaRMsbbA" target="_blank" class="buy-btn">Buy Now</a>
    </div>
    <button onclick="showPage('home')" style="margin-left:2rem">&larr; Back</button>
  `;
  showPage("productDetail");
}

function addToWishlist(index) {
  const item = products[index];
  if (!wishlist.find(p => p.name === item.name)) {
    wishlist.push(item);
    alert("Added to wishlist ‚úîÔ∏è");
  } else {
    alert("Already in wishlist.");
  }
}

function renderWishlist() {
  const ul = document.getElementById("wishlistItems");
  ul.innerHTML = "";
  wishlist.forEach((p, i) => {
    const li = document.createElement("li");
    li.innerHTML = `${p.name} <span class='remove' onclick='removeFromWishlist(${i})'>‚ùå</span>`;
    ul.appendChild(li);
  });
}

function removeFromWishlist(index) {
  wishlist.splice(index, 1);
  renderWishlist();
}

function requestOwnerAccess() {
  const pass = prompt("Enter owner password:");
  if (pass === "567812") toggleOwnerPanel(true);
  else alert("Wrong password.");
}

function toggleOwnerPanel(open) {
  document.getElementById("ownerPanel").classList.toggle("open", open);
  if (open) renderOwnerControls();
}

function renderOwnerControls() {
  const controls = document.getElementById("ownerControls");
  controls.innerHTML = "";
  products.forEach((p, i) => {
    const btn = document.createElement("button");
    btn.className = "toggle";
    btn.textContent = stockStatus[i] ? "Put Out of Stock" : "Put In Stock";
    btn.onclick = () => db.ref("stockStatus/" + i).set(!stockStatus[i]);

    const label = document.createElement("div");
    label.textContent = p.name;
    controls.appendChild(label);
    controls.appendChild(btn);
  });
}

function addProduct() {
  const name = document.getElementById("newName").value;
  const desc = document.getElementById("newDesc").value;
  const price = parseFloat(document.getElementById("newPrice").value);
  const shipping = parseFloat(document.getElementById("newShipping").value);
  if (!name || isNaN(price) || isNaN(shipping)) return alert("Please fill out all fields.");

  products.push({ name, desc, price, shipping });
  stockStatus[products.length - 1] = false;
  db.ref("products").set(products);
  db.ref("stockStatus").set(stockStatus);
  renderProducts();
  renderOwnerControls();
  alert("Product added!");
}

// Load products and stock from Firebase
function loadInitialData() {
  db.ref("products").once("value").then(snap => {
    products = snap.val() || [];
    if (!products.length) {
      products = [
        { name: "‚úèÔ∏è Custom Pencil", desc: "Handmade with your name.", price: 5, shipping: 1.5 },
        { name: "üîñ Bookmark", desc: "Cool bookmark made with care.", price: 3, shipping: 1.2 },
        { name: "üé® Sticker Pack 10", desc: "10 fun stickers.", price: 10, shipping: 1.8 },
        { name: "üñºÔ∏è Sticker Pack 8", desc: "8 stylish stickers.", price: 8, shipping: 1.7 },
        { name: "üß∑ Sticker Pack 4", desc: "4 cute stickers.", price: 4, shipping: 1.6 },
        { name: "üßÉ Sticker", desc: "Single collectible sticker.", price: 2, shipping: 1.1 }
      ];
      db.ref("products").set(products);
    }
    renderProducts();
  });
  db.ref("stockStatus").on("value", snap => {
    stockStatus = snap.val() || {};
    renderProducts();
    if (document.getElementById("ownerPanel").classList.contains("open")) {
      renderOwnerControls();
    }
  });
}

loadInitialData();
showPage("home");
</script>
</body>
</html>
