<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D1SPA4VR Merch</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body { background:#2f2f2f; color:#fff; font-family:Arial; margin:0; padding:0; min-height:100vh }
    header{ background:#111; color:#ff0033; padding:1rem; text-align:center; font-size:2.5rem; text-shadow:0 0 10px #ff0033 }
    .tabs{ display:flex; justify-content:center; background:#1e1e1e; padding:.8rem }
    .tabs button{ background:#ff0033; color:#fff; border:none; padding:.6rem 1.2rem; margin:0 .4rem; border-radius:4px; font-weight:bold; cursor:pointer }
    .footer{ text-align:center; color:#ccc; padding:1rem }
    .container{ display:flex; flex-wrap:wrap; justify-content:center; gap:1rem; padding:1rem }
    .product{ background:#444; width:200px; padding:1rem; border-radius:6px; text-align:center; }
    .product h2{ font-size:1.1rem; color:#ff0033 }
    .stock-label{ font-weight:bold; margin-top:.5rem }
    .in-stock{ color:#28a745 }
    .out-stock{ color:#ff4444 }
    .buy-btn{ background:#28a745; color:#fff; border:none; padding:.5rem; margin-top:.6rem; border-radius:4px; cursor:pointer }
    .buy-btn:disabled{ background:#555; cursor:not-allowed }
    .wishlist-btn, .cart-btn{ padding:.5rem; border:none; border-radius:4px; font-weight:bold; cursor:pointer }
    .wishlist-btn{ background:#ff9933; color:#000 }
    .cart-btn{ background:#007bff; color:#fff }
    .page { display:none }
    .visible { display:block }
    .product-detail{ max-width:800px; margin:2rem auto; background:#333; padding:1.5rem; border-radius:6px; display:flex; flex-wrap:wrap; }
    .product-detail .left{ flex:1 1 40%; padding-right:1rem }
    .product-detail .right{ flex:1 1 60%; padding-left:1rem }
    .product-detail h2{ color:#ff0033 }
    .product-detail p{ margin:.6rem 0 }
    .product-detail .buttons{ margin-top:1rem; display:flex; gap:.8rem; flex-wrap:wrap }
    .list-page ul{ list-style:none; padding:1rem }
    .list-page li{ background:#444; margin:.5rem 0; padding:.6rem; border-radius:4px; display:flex; justify-content:space-between }
    .list-page .remove{ cursor:pointer; color:red; font-weight:bold }
    #ownerBtn{ position:fixed; bottom:15px; right:15px; background:#ff0033; color:#fff; padding:.6rem; border:none; border-radius:4px; font-weight:bold; cursor:pointer }
    #ownerPanel{ display:none; background:#222; padding:1rem; min-height:80vh }
    #ownerPanel ul{ list-style:none; padding:0 }
    #ownerPanel li{ background:#444; margin:.5rem 0; padding:.6rem; border-radius:4px; display:flex; justify-content:space-between }
    .toggle-stock{ padding:.4rem 1rem; border:none; border-radius:4px; font-weight:bold; color:#fff; cursor:pointer }
    .in-stock-btn{ background:#28a745 }
    .out-stock-btn{ background:#ff4444 }
    #pwModal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); align-items:center; justify-content:center }
    #pwBox{ background:#222; padding:2rem; border-radius:6px; text-align:center }
    #pwBox input{ font-size:1.4rem; padding:.5rem; width:100%; margin-bottom:1rem; text-align:center; border-radius:4px; border:none }
    #pwBox button{ padding:.5rem 1rem; margin:.2rem; border:none; border-radius:4px; cursor:pointer }
  </style>
</head>
<body>

<header>D1SPA4VR Merch</header>
<div class="tabs">
  <button onclick="showPage('home')">Home</button>
  <button onclick="showPage('wishlist')">Wishlist</button>
  <button onclick="showPage('cart')">Cart</button>
</div>

<div id="home" class="page visible">
  <div class="container" id="productList"></div>
  <div class="footer">All prices USD + tax & shipping</div>
</div>

<div id="productPage" class="page">
  <div class="product-detail" id="productDetail"></div>
  <button class="back-btn" onclick="showPage('home')">‚Üê Back to Products</button>
</div>

<div id="wishlist" class="page list-page"><ul id="wishlistItems"></ul></div>
<div id="cart" class="page list-page"><ul id="cartItems"></ul></div>

<button id="ownerBtn">Owner</button>
<div id="ownerPanel">
  <h2>Stock Manager</h2><ul id="ownerProductList"></ul>
  <button onclick="showPage('home')">‚Üê Back</button>
</div>

<div id="pwModal">
  <div id="pwBox">
    <h3>Owner Password</h3>
    <input id="passwordInput" type="password" maxlength="6" />
    <button onclick="submitPwd()">OK</button>
    <button onclick="cancelPwd()">Cancel</button>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBDeI1Vtvnwpv4GPJfH9oqrhoD1BVVqebk",
    authDomain: "d1spa4vr-merch.firebaseapp.com",
    databaseURL: "https://d1spa4vr-merch-default-rtdb.firebaseio.com",
    projectId: "d1spa4vr-merch",
    storageBucket: "d1spa4vr-merch.appspot.com",
    messagingSenderId: "862122277887",
    appId: "1:862122277887:web:9db63669e5b2dac4f445ca"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database(), stockPath = 'productsStock';

  const products = [
    { name: "‚úèÔ∏è Custom Pencil", price: 5, desc: "A handmade pencil with your name.", shipping: 3.5, inStock: false },
    { name: "üîñ Bookmark", price: 3, desc: "A cool bookmark made with care.", shipping: 3.5, inStock: false },
    { name: "üé® Sticker Pack 10", price: 10, desc: "10 fun stickers.", shipping: 3.5, inStock: false },
    { name: "üñºÔ∏è Sticker Pack 8", price: 8, desc: "8 stylish stickers.", shipping: 3.5, inStock: false },
    { name: "üß∑ Sticker Pack 4", price: 4, desc: "4 cute stickers.", shipping: 3.5, inStock: false },
    { name: "üßÉ Sticker", price: 2, desc: "Single collectible sticker.", shipping: 3.5, inStock: false }
  ];
  let wishlist = [], cart = [], isOwnerOpen = false;

  db.ref(stockPath).on('value', snap => {
    const val = snap.val() || {};
    products.forEach((p, i) => p.inStock = !!val[i]);
    renderProducts(); if (isOwnerOpen) renderOwnerList();
  });

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('visible'));
    document.getElementById('ownerPanel').style.display = 'none';
    document.getElementById(id).classList.add('visible');
  }

  function renderProducts() {
    const c = document.getElementById('productList'); c.innerHTML = '';
    products.forEach((p, i) => {
      const e = document.createElement('div'); e.className = 'product';
      e.innerHTML = `
        <h2>${p.name}</h2>
        <p>$${p.price.toFixed(2)} + $${p.shipping.toFixed(2)}</p>
        <div class="stock-label ${p.inStock ? 'in-stock' : 'out-stock'}">
          ${p.inStock ? 'In Stock' : 'Out of Stock'}
        </div>
        <button class="buy-btn" ${!p.inStock ? 'disabled' : ''} onclick="openProduct(${i})">View</button>
      `;
      c.appendChild(e);
    });
  }

  function openProduct(i) {
    const p = products[i];
    document.getElementById('productDetail').innerHTML = `
      <div class="left">
        <h2>${p.name}</h2>
        <p><strong>$${p.price.toFixed(2)}</strong> + $${p.shipping.toFixed(2)}</p>
        <p>${p.desc}</p>
        <div class="stock-label ${p.inStock ? 'in-stock' : 'out-stock'}">${p.inStock ? 'In Stock' : 'Out of Stock'}</div>
      </div>
      <div class="right">
        <div class="buttons">
          <button class="wishlist-btn" onclick="addToList('wishlist',${i})">Add to Wishlist</button>
          <button class="cart-btn" onclick="addToList('cart',${i})">Add to Cart</button>
          <button class="buy-btn" onclick="buyNow(${i})" ${!p.inStock ? 'disabled' : ''}>Buy Now</button>
        </div>
      </div>`;
    showPage('productPage');
  }

  function addToList(type, i) {
    const list = (type === 'wishlist' ? wishlist : cart), item = products[i];
    if (!list.includes(item)) {
      if (type === 'cart' && !item.inStock) { alert('Out of Stock'); return }
      list.push(item); renderList(type);
      alert(type + ' added ‚úÖ');
    } else alert('Already added');
  }

  function renderList(type) {
    const list = (type === 'wishlist' ? wishlist : cart);
    const ul = document.getElementById(type + 'Items');
    ul.innerHTML = '';
    list.forEach((itm, i) => {
      const li = document.createElement('li');
      li.innerHTML = `${itm.name} <span class="remove" onclick="removeFromList('${type}',${i})">‚ùå</span>`;
      ul.appendChild(li);
    });
  }

  function removeFromList(type, i) {
    const list = (type === 'wishlist' ? wishlist : cart);
    list.splice(i, 1); renderList(type);
  }

  function buyNow(i) {
    window.location.href = 'https://docs.google.com/forms/d/e/1FAIpQLSe35Twu6jvan1QnK4Ad0gVS9BpaoidfQrsENpCymCoPtUJo8Q/viewform?usp=header';
  }

  document.getElementById('ownerBtn').onclick = () => { document.getElementById('pwModal').style.display = 'flex'; }
  function submitPwd() {
    if (document.getElementById('passwordInput').value === '567812') {
      document.getElementById('pwModal').style.display = 'none';
      document.getElementById('ownerPanel').style.display = 'block';
      showPage('ownerPanel'); isOwnerOpen = true; renderOwnerList();
    } else alert('Wrong password');
  }
  function cancelPwd() { document.getElementById('pwModal').style.display = 'none'; }

  function renderOwnerList() {
    const ul = document.getElementById('ownerProductList'); ul.innerHTML = '';
    products.forEach((p, i) => {
      const li = document.createElement('li');
      li.innerHTML = `${p.name}
        <button class="toggle-stock ${p.inStock ? 'in-stock-btn' : 'out-stock-btn'}" onclick="toggleStock(${i})">
          ${p.inStock ? 'Mark Out of Stock' : 'Mark In Stock'}
        </button>`;
      ul.appendChild(li);
    });
  }

  function toggleStock(i) {
    const newVal = !products[i].inStock;
    db.ref(`${stockPath}/${i}`).set(newVal);
  }

  renderProducts();
</script>
</body>
</html>
